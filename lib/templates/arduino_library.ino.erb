#include <malloc.h>
#include <Adafruit_NeoPixel_ZeroDMA.h>

#define INTEGER_SCALE <%= integer_scale %>
#define PIXEL_COUNT <%= pixels %>

long long_div(long numerator, long denominator)
{
  return (numerator * INTEGER_SCALE) / denominator;
}

long long_mult(long op1, long op2)
{
  return op1 * op2 / INTEGER_SCALE;
}

byte byte_mult(byte op1, byte op2)
{
  return (byte)((uint16_t)op1 * (uint16_t)op2 / (uint16_t)INTEGER_SCALE);
}

int neoPixelPin = <%= pin %>;

// How many NeoPixels we will be using, charge accordingly
int pixelCount = <%= pixels %>;

// Instatiate the NeoPixel from the library
Adafruit_NeoPixel_ZeroDMA strip = Adafruit_NeoPixel_ZeroDMA(pixelCount, neoPixelPin, NEO_GRB + NEO_KHZ800);

void setup() {
  strip.begin();
}

void loop() {
  calculate_strip();
  delay(10);
}

// beginning of top level scope definition

<%= tls %>

// end of top level scope definition

void calculate_strip() {
  long mils = millis();
  for (int i=0; i < pixelCount; i++) {
    long this_phase = long_div(i, pixelCount - 1);
// beginning of generated code

<%= body %>

// end of generated code
  }
  strip.show();
}

<%= code %>

void maxfunction(long op1[3], long op2[3], long out[3]) {
  out[0] = max(op1[0], op2[0]);
  out[1] = max(op1[1], op2[1]);
  out[2] = max(op1[2], op2[2]);
}

